
const countryDataCopy =[
	{
		"name": "Nigeria",
		"capital": "Abuja",
		"languages": [
				"English"
		],
		"population": 206139587,
		"flag": "https://flagcdn.com/ng.svg",
		"region": "Africa",
		"area": 923768
},
			{
				"name": "Canada",
				"capital": "Ottawa",
				"languages": [
						"English",
						"French"
				],
				"population": 38005238,
				"flag": "https://flagcdn.com/ca.svg",
				"region": "Americas",
				"area": 9984670
		},
			{
					"name": "Iceland",
					"capital": "Reykjavík",
					"languages": [
							"Icelandic"
					],
					"population": 366425,
					"flag": "https://flagcdn.com/is.svg",
					"region": "Europe",
					"area": 103000
			},
			{
					"name": "India",
					"capital": "New Delhi",
					"languages": [
							"Hindi",
							"English"
					],
					"population": 1380004385,
					"flag": "https://flagcdn.com/in.svg",
					"region": "Asia",
					"area": 3287590
			},
			{
					"name": "Indonesia",
					"capital": "Jakarta",
					"languages": [
							"Indonesian"
					],
					"population": 273523621,
					"flag": "https://flagcdn.com/id.svg",
					"region": "Asia",
					"area": 1904569
			},
			{
				"name": "China",
				"capital": "Beijing",
				"languages": [
						"Chinese"
				],
				"population": 1402112000,
				"flag": "https://flagcdn.com/cn.svg",
				"region": "Asia",
				"area": 9640011
		},
	{
					"name": "Iraq",
					"capital": "Baghdad",
					"languages": [
							"Arabic",
							"Kurdish"
					],
					"population": 40222503,
					"flag": "https://flagcdn.com/iq.svg",
					"region": "Asia",
					"area": 438317
			},
			{
					"name": "Ireland",
					"capital": "Dublin",
					"languages": [
							"Irish",
							"English"
					],
					"population": 4994724,
					"flag": "https://flagcdn.com/ie.svg",
					"region": "Europe",
					"area": 70273
			},
			{
				"name": "Pakistan",
				"capital": "Islamabad",
				"languages": [
						"Urdu",
						"English"
				],
				"population": 220892331,
				"flag": "https://flagcdn.com/pk.svg",
				"region": "Asia",
				"area": 881912
		},
			{
					"name": "Isle of Man",
					"capital": "Douglas",
					"languages": [
							"English",
							"Manx"
					],
					"population": 85032,
					"flag": "https://flagcdn.com/im.svg",
					"region": "Europe",
					"area": 572
			},
			{
				"name": "Brazil",
				"capital": "Brasília",
				"languages": [
						"Portuguese"
				],
				"population": 212559409,
				"flag": "https://flagcdn.com/br.svg",
				"region": "Americas",
				"area": 8515767
		},
			{
					"name": "Israel",
					"capital": "Jerusalem",
					"languages": [
							"Hebrew (modern)",
							"Arabic"
					],
					"population": 9216900,
					"flag": "https://flagcdn.com/il.svg",
					"region": "Asia",
					"area": 20770
			},
			{
					"name": "Italy",
					"capital": "Rome",
					"languages": [
							"Italian"
					],
					"population": 59554023,
					"flag": "https://flagcdn.com/it.svg",
					"region": "Europe",
					"area": 301336
			},
			{
					"name": "Jamaica",
					"capital": "Kingston",
					"languages": [
							"English"
					],
					"population": 2961161,
					"flag": "https://flagcdn.com/jm.svg",
					"region": "Americas",
					"area": 10991
			},
			{
				"name": "United States of America",
				"capital": "Washington, D.C.",
				"languages": [
						"English"
				],
				"population": 329484123,
				"flag": "https://flagcdn.com/us.svg",
				"region": "Americas",
				"area": 9629091
		},
			{
					"name": "Japan",
					"capital": "Tokyo",
					"languages": [
							"Japanese"
					],
					"population": 125836021,
					"flag": "https://flagcdn.com/jp.svg",
					"region": "Asia",
					"area": 377930
			},
			{
					"name": "Jersey",
					"capital": "Saint Helier",
					"languages": [
							"English",
							"French"
					],
					"population": 100800,
					"flag": "https://flagcdn.com/je.svg",
					"region": "Europe",
					"area": 116
			},
			{
				"name": "Russian Federation",
				"capital": "Moscow",
				"languages": [
						"Russian"
				],
				"population": 144104080,
				"flag": "https://flagcdn.com/ru.svg",
				"region": "Europe",
				"area": 17124442
		},
			{
					"name": "Jordan",
					"capital": "Amman",
					"languages": [
							"Arabic"
					],
					"population": 10203140,
					"flag": "https://flagcdn.com/jo.svg",
					"region": "Asia",
					"area": 89342
			},
			{
					"name": "Kazakhstan",
					"capital": "Nur-Sultan",
					"languages": [
							"Kazakh",
							"Russian"
					],
					"population": 18754440,
					"flag": "https://flagcdn.com/kz.svg",
					"region": "Asia",
					"area": 2724900
			},
			{
					"name": "Kenya",
					"capital": "Nairobi",
					"languages": [
							"English",
							"Swahili"
					],
					"population": 53771300,
					"flag": "https://flagcdn.com/ke.svg",
					"region": "Africa",
					"area": 580367
			},
			{
					"name": "Kiribati",
					"capital": "South Tarawa",
					"languages": [
							"English"
					],
					"population": 119446,
					"flag": "https://flagcdn.com/ki.svg",
					"region": "Oceania",
					"area": 811
			},
			{
					"name": "Kuwait",
					"capital": "Kuwait City",
					"languages": [
							"Arabic"
					],
					"population": 4270563,
					"flag": "https://flagcdn.com/kw.svg",
					"region": "Asia",
					"area": 17818
			},
			{
					"name": "Kyrgyzstan",
					"capital": "Bishkek",
					"languages": [
							"Kyrgyz",
							"Russian"
					],
					"population": 6591600,
					"flag": "https://flagcdn.com/kg.svg",
					"region": "Asia",
					"area": 199951
			},
			{
					"name": "Lao People's Democratic Republic",
					"capital": "Vientiane",
					"languages": [
							"Lao"
					],
					"population": 7275556,
					"flag": "https://flagcdn.com/la.svg",
					"region": "Asia",
					"area": 236800
			},
			{
					"name": "Latvia",
					"capital": "Riga",
					"languages": [
							"Latvian"
					],
					"population": 1901548,
					"flag": "https://flagcdn.com/lv.svg",
					"region": "Europe",
					"area": 64559
			},
			{
					"name": "Lebanon",
					"capital": "Beirut",
					"languages": [
							"Arabic",
							"French"
					],
					"population": 6825442,
					"flag": "https://flagcdn.com/lb.svg",
					"region": "Asia",
					"area": 10452
			},
			{
					"name": "Lesotho",
					"capital": "Maseru",
					"languages": [
							"English",
							"Southern Sotho"
					],
					"population": 2142252,
					"flag": "https://flagcdn.com/ls.svg",
					"region": "Africa",
					"area": 30355
			},
			{
					"name": "Liberia",
					"capital": "Monrovia",
					"languages": [
							"English"
					],
					"population": 5057677,
					"flag": "https://flagcdn.com/lr.svg",
					"region": "Africa",
					"area": 111369
			},
	        {
					"name": "Bahrain",
					"capital": "Manama",
					"languages": [
							"Arabic"
					],
					"population": 1701583,
					"flag": "https://flagcdn.com/bh.svg",
					"region": "Asia",
					"area": 765
			},
			{
					"name": "Bangladesh",
					"capital": "Dhaka",
					"languages": [
							"Bengali"
					],
					"population": 164689383,
					"flag": "https://flagcdn.com/bd.svg",
					"region": "Asia",
					"area": 147570
			},
			{
					"name": "Barbados",
					"capital": "Bridgetown",
					"languages": [
							"English"
					],
					"population": 287371,
					"flag": "https://flagcdn.com/bb.svg",
					"region": "Americas",
					"area": 430
			},
			{
					"name": "Belarus",
					"capital": "Minsk",
					"languages": [
							"Belarusian",
							"Russian"
					],
					"population": 9398861,
					"flag": "https://flagcdn.com/by.svg",
					"region": "Europe",
					"area": 207600
			},
			{
					"name": "Belgium",
					"capital": "Brussels",
					"languages": [
							"Dutch",
							"French",
							"German"
					],
					"population": 11555997,
					"flag": "https://flagcdn.com/be.svg",
					"region": "Europe",
					"area": 30528
			},
			{
					"name": "Belize",
					"capital": "Belmopan",
					"languages": [
							"English",
							"Spanish"
					],
					"population": 397621,
					"flag": "https://flagcdn.com/bz.svg",
					"region": "Americas",
					"area": 22966
			},
			{
					"name": "Benin",
					"capital": "Porto-Novo",
					"languages": [
							"French"
					],
					"population": 12123198,
					"flag": "https://flagcdn.com/bj.svg",
					"region": "Africa",
					"area": 112622
			},
			{
					"name": "Bermuda",
					"capital": "Hamilton",
					"languages": [
							"English"
					],
					"population": 63903,
					"flag": "https://flagcdn.com/bm.svg",
					"region": "Americas",
					"area": 54
			},
			{
					"name": "Bhutan",
					"capital": "Thimphu",
					"languages": [
							"Dzongkha"
					],
					"population": 771612,
					"flag": "https://flagcdn.com/bt.svg",
					"region": "Asia",
					"area": 38394
			},
			{
					"name": "Bolivia (Plurinational State of)",
					"capital": "Sucre",
					"languages": [
							"Spanish",
							"Aymara",
							"Quechua"
					],
					"population": 11673029,
					"flag": "https://flagcdn.com/bo.svg",
					"region": "Americas",
					"area": 1098581
			},
	        {
					"name": "Senegal",
					"capital": "Dakar",
					"languages": [
							"French"
					],
					"population": 16743930,
					"flag": "https://flagcdn.com/sn.svg",
					"region": "Africa",
					"area": 196722
			},
			{
					"name": "Serbia",
					"capital": "Belgrade",
					"languages": [
							"Serbian"
					],
					"population": 6908224,
					"flag": "https://flagcdn.com/rs.svg",
					"region": "Europe",
					"area": 88361
			},
			{
					"name": "Seychelles",
					"capital": "Victoria",
					"languages": [
							"French",
							"English"
					],
					"population": 98462,
					"flag": "https://flagcdn.com/sc.svg",
					"region": "Africa",
					"area": 452
			},
{
		"name": "Sierra Leone",
		"capital": "Freetown",
		"languages": [
				"English"
		],
		"population": 7976985,
		"flag": "https://flagcdn.com/sl.svg",
		"region": "Africa",
		"area": 71740
},
{
		"name": "Singapore",
		"capital": "Singapore",
		"languages": [
				"English",
				"Malay",
				"Tamil",
				"Chinese"
		],
		"population": 5685807,
		"flag": "https://flagcdn.com/sg.svg",
		"region": "Asia",
		"area": 710
},
{
		"name": "Sint Maarten (Dutch part)",
		"capital": "Philipsburg",
		"languages": [
				"Dutch",
				"English"
		],
		"population": 40812,
		"flag": "https://flagcdn.com/sx.svg",
		"region": "Americas",
		"area": 34
},
{
		"name": "Slovakia",
		"capital": "Bratislava",
		"languages": [
				"Slovak"
		],
		"population": 5458827,
		"flag": "https://flagcdn.com/sk.svg",
		"region": "Europe",
		"area": 49037
},
{
		"name": "Slovenia",
		"capital": "Ljubljana",
		"languages": [
				"Slovene"
		],
		"population": 2100126,
		"flag": "https://flagcdn.com/si.svg",
		"region": "Europe",
		"area": 20273
},
{
		"name": "Solomon Islands",
		"capital": "Honiara",
		"languages": [
				"English"
		],
		"population": 686878,
		"flag": "https://flagcdn.com/sb.svg",
		"region": "Oceania",
		"area": 28896
},
{
		"name": "Somalia",
		"capital": "Mogadishu",
		"languages": [
				"Somali",
				"Arabic"
		],
		"population": 15893219,
		"flag": "https://flagcdn.com/so.svg",
		"region": "Africa",
		"area": 637657
},
{
    "name": "Wallis and Futuna",
    "capital": "Mata-Utu",
    "languages": [
            "French"
    ],
    "population": 11750,
    "flag": "https://flagcdn.com/wf.svg",
    "region": "Oceania",
    "area": 142
},
{
    "name": "Western Sahara",
    "capital": "El Aaiún",
    "languages": [
            "Spanish"
    ],
    "population": 510713,
    "flag": "https://flagcdn.com/eh.svg",
    "region": "Africa",
    "area": 266000
},
{
    "name": "Yemen",
    "capital": "Sana'a",
    "languages": [
            "Arabic"
    ],
    "population": 29825968,
    "flag": "https://flagcdn.com/ye.svg",
    "region": "Asia",
    "area": 527968
},
{
    "name": "Zambia",
    "capital": "Lusaka",
    "languages": [
            "English"
    ],
    "population": 18383956,
    "flag": "https://flagcdn.com/zm.svg",
    "region": "Africa",
    "area": 752618
},
{
    "name": "Afghanistan",
    "capital": "Kabul",
    "languages": [
            "Pashto",
            "Uzbek",
            "Turkmen"
    ],
    "population": 40218234,
    "flag": "https://upload.wikimedia.org/wikipedia/commons/5/5c/Flag_of_the_Taliban.svg",
    "region": "Asia",
    "area": 652230
},
{
    "name": "Aland Islands",
    "capital": "Mariehamn",
    "languages": [
            "Swedish"
    ],
    "population": 28875,
    "flag": "https://flagcdn.com/ax.svg",
    "region": "Europe",
    "area": 1580
},
{
"name": "Vietnam",
"capital": "Hanoi",
"languages": [
        "Vietnamese"
],
"population": 97338583,
"flag": "https://flagcdn.com/vn.svg",
"region": "Asia",
"area": 331212
}

]


//Selected element using Dom property
let nameBtn = document.querySelector('.nameBtn')
let capitalBtn = document.querySelector('.capitalBtn')
let populationBtn = document.querySelector('.populationBtn')
let inputFeild = document.getElementById('inputF');
let countryBlockWrapper = document.getElementById('countryBlockWrapper');
let graphElement = document.getElementById('graphs')
let btnPopulation = document.getElementById('population');
let btnLanguage = document.getElementById('languages')
let message = document.getElementById('message');


// global array
let filteredArr1 =[]
let filteredArr2 =[]
let filteredArr3 =[]
let count =  []
let globArr = []
let cPopulation = []

// global variable
let totPopulation =7758589152;


//building cPopulation and sorting the that cPopulation array
function buildCPop(arr){
	cPopulation = []
	for(const i of arr){
		Array.prototype.push.apply(cPopulation, [{country :i.name , pop :i.population}]);
	}
	cPopulation.sort((a , b) => {
		return b.pop - a.pop
	})
}


//this function will append content to population graph according to the data that matched 
// the value in the input feild
function populationGraph(){
	graphElement.innerHTML =""

	message.innerHTML =""
	message.innerHTML = 'Countries sorted according to population'

	graphElement.innerHTML += `<div class="graph-wrapper" id="stat">
	<p id="firstP">World</p>
	<div id="barDiv">
		<div id="innerBarDiv" style="width: 100%;" ></div>
	</div>
	<p id="secP"> ${totPopulation}</p>
</div><br>`
let len = cPopulation.length > 9 ? 9 : cPopulation.length
	for( let i =0; i< len ; ++i){
	
		console.log(' I am here')
		
		graphElement.innerHTML += `<div class="graph-wrapper" id="stat">
		<p id="firstP">${cPopulation[i].country}</p>
		<div id="barDiv">
			<div id="innerBarDiv" style="width: ${cPopulation[i].pop/totPopulation *200}%;" ></div>
		</div>
		<p id="secP"> ${cPopulation[i].pop}</p>
	</div><br>`
	}
}

//Utility function for Appending data to html element called country Block 
function appendElement (newArr){
let len;
len = newArr.length > 21 ? 21 : newArr.length

	for( let i = 0 ; i < len ; ++i){
	
		countryBlockWrapper.innerHTML += ` <div class="countryBlock">
		<img id="flag" src=${newArr[i].flag} height="45px">
		<p id="countryName">${newArr[i].name}</p>
		<p id="countryCapital">Capital: ${newArr[i].capital}</p>
		<p id="countryLang">Language:  ${newArr[i].languages.map((item) => {
			return item + ' '
		}) }</p>
		<p id="countryPop">Population:  ${newArr[i].population}</p>
	</div>`
	}
}

//this will append html content dyanamically to country Block Wrapper when
// the script will load for the first time
for( let i = 0 ; i < 21 ; ++i){

	countryBlockWrapper.innerHTML += ` <div class="countryBlock">
	<img id="flag" src=${countryDataCopy[i].flag} height="45px">
	<p id="countryName">${countryDataCopy[i].name}</p>
	<p id="countryCapital">Capital: ${countryDataCopy[i].capital}</p>
	<p id="countryLang">Language:  ${countryDataCopy[i].languages.map((item) => {
		return item + ' '
	}) }</p>
	<p id="countryPop">Population:  ${countryDataCopy[i].population}</p>
</div>`

}

//Sorting according to country name
function comp1( a ,b ) {
	if (a.name < b.name){
		return -1;
	  }
	  if (a.name > b.name){
		return 1;
	  }
	  return 0;
}

nameBtn.addEventListener('click' , function(){
	
	nameBtn.classList.add('bordershow')
	capitalBtn.classList.remove('bordershow');
	populationBtn.classList.remove('bordershow')

	countryBlockWrapper.innerHTML= ""

	if(filteredArr1.length ==0 && filteredArr2.length ==0 && filteredArr3.length == 0)
	{countryDataCopy.sort(comp1)
		appendElement(countryDataCopy)
}
	else if(filteredArr1.length > 0){
		filteredArr1.sort(comp1)
		appendElement(filteredArr1)
		buildCPop(filteredArr1);
		populationGraph();
	}
	else if(filteredArr2.length > 0){
		filteredArr2.sort(comp1)
		appendElement(filteredArr2)
		buildCPop(filteredArr2);
		populationGraph();
	}
	else if(filteredArr3.length > 0){
		filteredArr3.sort(comp1)
		appendElement(filteredArr3)
		buildCPop(filteredArr3);
		populationGraph();
	}

})

//Sorting according to country capital
function comp2( a ,b ) {
	if (a.capital < b.capital){
		return -1;
	  }
	  if (a.name > b.name){
		return 1;
	  }
	  return 0;
}
capitalBtn.addEventListener('click' , function(){

	nameBtn.classList.remove('bordershow')
	capitalBtn.classList.add('bordershow');
	populationBtn.classList.remove('bordershow')
	

	countryBlockWrapper.innerHTML= ""

	if(filteredArr1.length ==0 && filteredArr2.length ==0 && filteredArr3.length == 0)
		{countryDataCopy.sort(comp2)
			appendElement(countryDataCopy)
	}
		else if(filteredArr1.length > 0){
			filteredArr1.sort(comp2)
			appendElement(filteredArr1)
			buildCPop(filteredArr1);
			populationGraph();
		}
		else if(filteredArr2.length > 0){
			filteredArr2.sort(comp2)
			appendElement(filteredArr2)
			buildCPop(filteredArr2);
			populationGraph();
		}
		else if(filteredArr3.length > 0){
			filteredArr3.sort(comp2)
			appendElement(filteredArr3)
			buildCPop(filteredArr3);
			populationGraph();
		}
})

//Sorting according to country Population
populationBtn.addEventListener('click' , function(){
		

		nameBtn.classList.remove('bordershow')
		capitalBtn.classList.remove('bordershow');
		populationBtn.classList.add('bordershow')

		countryBlockWrapper.innerHTML= ""
	if(filteredArr1.length ==0 && filteredArr2.length ==0 && filteredArr3.length == 0)
		{countryDataCopy.sort((a , b) =>  b.population - a.population)
			appendElement(countryDataCopy)
	}
		else if(filteredArr1.length > 0){
			filteredArr1.sort((a , b) =>  b.population - a.population)
			appendElement(filteredArr1)
			buildCPop(filteredArr1);
			populationGraph();
		}
		else if(filteredArr2.length > 0){
			filteredArr2.sort((a , b) =>  b.population - a.population)
			appendElement(filteredArr2)
			buildCPop(filteredArr2);
			populationGraph();
		}
		else if(filteredArr3.length > 0){
			filteredArr3.sort((a , b) =>  b.population - a.population)
			appendElement(filteredArr3)
			buildCPop(filteredArr3);
			populationGraph();
		}
})



inputFeild.addEventListener('input' ,function(e){
	let value = e.target.value
console.log(value)
	filteredArr1 = countryDataCopy.filter((data) =>{
		let cName = data.name.toLowerCase();
		return cName.includes(value)
	})
	filteredArr2 = countryDataCopy.filter((data) =>{
		let cCapital = data.capital.toLowerCase();
		return cCapital.includes(value)
	})
	filteredArr3 = countryDataCopy.filter((data) =>{
	
		let newArr = data.languages.filter((d) => {
			let lang = d.toLowerCase()
			return lang.includes(value.toLowerCase())
		})
		return newArr.length > 0 ? true : false;
		
	})

	nameBtn.classList.remove('bordershow')
	capitalBtn.classList.remove('bordershow');
	populationBtn.classList.remove('bordershow')

	if(filteredArr1.length >0){
		countryBlockWrapper.innerHTML="";

		appendElement(filteredArr1)
		buildCPop(filteredArr1)
		populationGraph()
		console.log(filteredArr1)
	}
	else if(filteredArr2.length > 0){
		countryBlockWrapper.innerHTML="";

		appendElement(filteredArr2)
		buildCPop(filteredArr2)
		populationGraph()
		console.log(filteredArr2)
	}
	else if(filteredArr3.length > 0){
		console.log(filteredArr3)
		countryBlockWrapper.innerHTML="";

		appendElement(filteredArr3)
		buildCPop(filteredArr3)
		populationGraph()
	}
	else{
		countryBlockWrapper.innerHTML=""
		countryBlockWrapper.innerHTML=`<h2 class="voidHeader">No Matching Data</h2>`;
		message.innerHTML=""
		graphElement.innerHTML =""
	}

	
})


// for Language Count 
for(const i of countryDataCopy){
	Array.prototype.push.apply(globArr, i.languages);
}
const langSet = new Set(globArr)

for (const l of langSet) {
  const filteredLang = globArr.filter((lng) => lng === l)
//   console.log(filteredLang) // ["English", "English", "English"]
  count.push({ lang: l, count: filteredLang.length })
}
count.sort((a, b) => {
    return b.count - a.count;
});

//<--------------------------------------------------------------------------------------------------->
// Appending to the html the languange count data

btnLanguage.addEventListener('click' , function(){
	graphElement.innerHTML =""
	message.innerHTML =""
	message.innerHTML = 'Top ten spoken Language in world'
	for( let i =0; i< 10 ; ++i){
	
		console.log(' I am here')
		
		graphElement.innerHTML += `<div class="graph-wrapper" id="stat">
		<p id="firstP">${count[i].lang}</p>
		<div id="barDiv">
			<div id="innerBarDiv" style="width: ${count[i].count/56 * 200}%;" ></div>
		</div>
		<p id="secP"> ${count[i].count}</p>
	</div><br>`
	}
})


// For Population Count

//Appending the population count on population button click
btnPopulation.addEventListener('click' , function(){
	buildCPop(countryDataCopy)
	
	graphElement.innerHTML =""
	message.innerHTML =""
	message.innerHTML = 'Top Ten Populated Countries in world'

	graphElement.innerHTML += `<div class="graph-wrapper" id="stat">
	<p id="firstP">World</p>
	<div id="barDiv">
		<div id="innerBarDiv" style="width: 100%;" ></div>
	</div>
	<p id="secP"> ${totPopulation}</p>
</div><br>`

	for( let i =0; i< 9 ; ++i){
	
		console.log(' I am here')
		
		graphElement.innerHTML += `<div class="graph-wrapper" id="stat">
		<p id="firstP">${cPopulation[i].country}</p>
		<div id="barDiv">
			<div id="innerBarDiv" style="width: ${cPopulation[i].pop/totPopulation *200}%;" ></div>
		</div>
		<p id="secP"> ${cPopulation[i].pop}</p>
	</div><br>`
	}
})


// function comp( a ,b ) {
//     if (a.name < b.name){
//         return -1;
//       }
//       if (a.name > b.name){
//         return 1;
//       }
//       return 0;
// }
// countriesData.sort( comp)
// count.sort((a, b) => {
//     return b.count - a.count;
// });